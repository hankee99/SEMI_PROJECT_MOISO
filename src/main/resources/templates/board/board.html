<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>board</title>
</head>
<style>

.board{
    position: relative;
}
.board-wrap{
    width: 600px;
    margin: 0 auto;
}
.board-content-wrap{
    padding-top: 25px;
}
.board-thumb{
    margin: 0 auto;
    text-align: center;
    overflow: hidden;
    height: 400px;
}
.board-thumb>img{
    width: 100%;
    height: 100%;
    object-fit: cover;
}


.board-info-img{
    margin: 0 auto;
    text-align: center;
    height: 50px;
    width: 100%;
    position: absolute;
    top: 375px;
    cursor: pointer;
}
.board-info-img>img{
    height: 100%;
    border-radius: 50px;
}
.board-info-user{
    text-align: center;
   	cursor: pointer;
   	margin-top: 5px;
}
.board-info-user>p{
    font-size: 11px;
}

.board-title{
    text-align: center;
    color: #000;
    font-size: 20px;
}
.board-content{
    white-space: pre-wrap;
}

.board-like{
    display: flex;
    align-items: center;
    justify-content: center;
    color:#000
}
.board-like .material-icons{
    color: gray;
    font-size: 20px;
    margin: 3px;
    cursor: pointer;
}
.board-up{
	width: 120px;
	height: 35px;
	margin-left: 480px;
}
.board-date{
	margin-botton: 10px;
}

/*게시자 프로필*/
.board-user{
    overflow: hidden;
    margin-bottom: 20px;
}
.board-user-img{
    width: 50px;
    height: 50px;
    float: left;
    border-radius: 25px;
    overflow: hidden;
    cursor: pointer;

}
.board-user-img>img{
    height: 100%;
}

.board-user-info{
    margin-left: 10px;
    width: 540px;
    float: left;
    overflow: hidden;
}

.board-user-name{
    margin-bottom: 3px;
    color: #000;
    cursor: pointer;
}
.board-user-text{
    height: 15px;
    font-size: 12px;
} 
/*댓글쓰기*/
.board-comment{

}
.board-comment-write{
    overflow: hidden;

}
.comment-img-box{
    width: 85px;
    float: left;
    padding: 17.5px 0px;
    cursor: pointer;
}
.comment-img{
    width: 50px;
    height: 50px;
    margin: 0 auto;
    border-radius: 25px;
    overflow: hidden;
}
.comment-img>img{
    height: 100%;
}
.comment-content{
    width: 515px;
    float: left;

}
.comment-text{
    width: 515px;
    float: left;
}
.comment-write{
    width: 515px;
    padding: 7px 7px;
    margin-top: 15px;
    border: none;
    border-bottom: 1px solid rgb(184, 184, 184);
    outline: none;
    min-height: 30px;
    color: #000;
}
.comment-text>textarea{
    display: none;
}
.comment-write:focus{
    border-bottom-color: black;
}
.submit-box{
    width: 515px;
    float: left;
    text-align: right;
}
.board-date>span:first-child{
	font-size: 12px;
	margin-right: 5px;
}

/*댓글보기*/
.board-comment-read{
    overflow: hidden;
}
.read-comment-img-box{
    width: 85px;
    float: left;
    padding: 17.5px 0px;
}
.read-comment-img{
    width: 50px;
    height: 50px;
    margin: 0 auto;
    border-radius: 25px;
    overflow: hidden;
    cursor: pointer;
}
.read-comment-img>img{
    height: 100%;
}
.read-comment-content{
    width: 515px;
    float: left;
}
.read-comment-text{
    width: 515px;
    float: left;
}
.reRead-comment-content{
    width: 515px;
    float: left;
}
.reRead-comment-text{
    width: 515px;
    float: left;
}
.comment-read{
    width: 515px;
    border: none;
    outline: none;
    min-height: 30px;
    color: #000;
    margin-bottom: 0;
}
.read-comment-write:focus{
    border-bottom-color: black;
}
.comment-like-box{
    width: 40px;
    height: 40px;
    float: left;
}
.comment-like{
    height: 40px;
}
.read-submit-box{
    width: 475px;
    float: left;
    text-align: left;
}
.btn-primary-del{
    height: 35px;
    width: 55px;
    background-color: aliceblue;
    border: none;
    border-radius: 50px;
    font-size: 13px;
}
.btn-primary-del:hover{
    background-color: rgb(202, 202, 202);
}
.btn-primary-up{
    height: 35px;
    width: 55px;
    background-color: aliceblue;
    border: none;
    border-radius: 50px;
    font-size: 13px;
}
.btn-primary-comment-up{
    height: 35px;
    width: 55px;
    background-color: aliceblue;
    border: none;
    border-radius: 50px;
    font-size: 13px;
    margin-left: 300px;
}
.btn-primary-reComment-up{
    height: 35px;
    width: 55px;
    background-color: aliceblue;
    border: none;
    border-radius: 50px;
    font-size: 13px;
    margin-left: 0px;
}
.btn-primary-up:hover{
    background-color: rgb(202, 202, 202);
}
.btn-primary-comment-up:hover{
    background-color: rgb(202, 202, 202);
}
.btn-primary-reComment-up:hover{
    background-color: rgb(202, 202, 202);
}
.btn-primary-recomment{
    height: 35px;
    width: 55px;
    background-color: aliceblue;
    border: none;
    border-radius: 50px;
    font-size: 13px;

}
.btn-primary-recomment:hover{
    background-color: rgb(202, 202, 202);
}
.board-comment-read{
    overflow: hidden;
}
.read-comment-user-name{
    min-width: 1px;
    height: 25px;
    float: left;
    margin-top: 15px;
    margin-right: 5px;
    color: #000;
    cursor: pointer;
}
.read-comment-user-name>div{
	font-size: 15px;
	font-weight: 900;
}
.read-comment-user-date{
    width: min-70px;
    height: 25px;
    float: left;
    padding-top: 20px;
}
.read-comment-user-date>div{
    font-size: 12px;
}
.read-comment-text{
    float: left;
}
.comment-read{
	margin-top: 5px;
}
.comment-like{
    display: flex;
    align-items: center;
}
.comment-like>.material-icons{
    color: gray;
    font-size: 20px;
    cursor: pointer;
}
.comment-like>span:last-child{
    font-size: 13px;
    margin-left: 3px;
}

/*답글*/
.board-recomment{
}
.board-recomment-write{
    overflow: hidden;
    margin-left: 75px;
}
.recomment-img-box{
    width: 85px;
    float: left;
    padding: 17.5px 0px;
    cursor: pointer;
}
.recomment-img{
    width: 50px;
    height: 50px;
    margin: 0 auto;
    border-radius: 25px;
    overflow: hidden;
}
.recomment-img>img{
    height: 100%;
}
.recomment-content{
    width: 440px;
    float: left;

}
.recomment-text{
    width: 440px;
    float: left;
}
.recomment-write{
    width: 440px;
    padding: 7px 7px;
    margin-top: 15px;
    border: none;
    border-bottom: 1px solid rgb(184, 184, 184);
    outline: none;
    min-height: 30px;
    color: #000;
}
.recomment-text>textarea{
    display: none;
}
.recomment-write:focus{
    border-bottom-color: black;
}
.recomment-submit-box{
    width: 440px;
    float: left;
    text-align: right;
}
.btn-primary-comment{
    height: 35px;
    width: 55px;
    background-color: aliceblue;
    border: none;
    border-radius: 50px;
    font-size: 13px;
    margin-top: 5px;
}
.btn-primary-comment-can{
	height: 35px;
    width: 55px;
    background-color: aliceblue;
    border: none;
    border-radius: 50px;
    font-size: 13px;
    margin-top: 5px;
}
.btn-primary-comment:hover{
    background-color: rgb(202, 202, 202);
}
.btn-primary-comment-can:hover{
    background-color: rgb(202, 202, 202);
}

.board-recomment{
	display: none;
}

/*대댓글출력*/
.reBoard-comment-read{
	width: 525px;
	margin-left: 75px;
}
.reRead-submit-box{
	width: 440px;
}
.reRecomment-text{
	width: 440px;
}
.reRead-comment-content{
	width: 440px;
}
.reRead-comment-text{
	width: 440px;
}
.reRead-submit-box{
    width: 400px;
    float: left;
    text-align: right;
}

/*댓글수정*/
.read-comment-text>textarea{
	display: none;
}
.read-comment-text>div{
	display: none;
}
</style>
<body>
        <th:block th:include="common/header"></th:block>
	        
	        
		<div class="board-wrap">
		    <th:block th:each="b : ${b}">
	            <div class="board">
	                <div class="board-thumb">
	                    <img th:src="'/moisoPhoto/'+${b.boardPicture}">
	                </div>
	
	                <div class="board-info-img">
	                    <img src="img/about.jpg">
	                </div>
	
	                <div class="board-content-wrap">
	
	                    <div class="board-info-user">
	                         <p th:text="${b.memberNickname}"></p>
	                    </div>                           
	                             
	                    <div class="board-title">
	                        <span th:text="${b.boardTitle}"><b></b></span>
	                    </div>
	        
	                    <div class="board-content">
	                        <p th:utext="${b.boardContent}"></p>
	                    </div>
	        
	                    <div class="board-date">
	                        <span th:text="${b.boardDate}"></span>
	                        <span>조회수 </span><span th:text="${b.boardReadCount}"></span>                       
	                    </div>
	                    <div class="board-like">
	                        <span>좋아요</span>
	                       	<span class="material-icons">favorite</span>
	                        <span>5</span>
	                    </div>
	                </div>
                       
           </th:block>
                     
                        
                        <div class="board-up">
                        	<th:block th:if="${session.member != null && session.member.memberNickname == b.memberNickname}">
	                            <button type="submit" class="btn-primary-up" th:onclick="updateBoard([[${b.boardNo}]],[[${b.memberNickname}]]);">수정</button>
	                            <button type="submit" class="btn-primary-del" th:onclick="deleteBoard([[${b.boardNo}]]);">삭제</button>
                            </th:block>
                        </div>
                        <div class="board-user">
                            <div class="board-user-img">
                                <img src="img/about.jpg">
                            </div>
                            <div class="board-user-info">
                                <div class="board-user-name">문현준</div>
                                <div class="board-user-text">함께 그리고 혼자서 할 수 있는 홈베이킹을 좋아해요. 베이킹 일정 진행 & 협업관련은 메세지 주세요 😇ㅋㅋㅋㅋㅋㅋㅋ</div>
                            </div>
                        </div>
                    </div>
                

			<!-- 댓글 입력 -->
            <div class="board-comment" th:if="${session.member != null}">
            	<form action="/board/insertComment" method="post">
	                <div class="board-comment-write">
	                    <div class="comment-img-box">
	                        <div class="comment-img">
	                            <img src="img/about.jpg">
	                        </div>
	                    </div>
	                    <div class="comment-content">
	                    
							<input type="hidden" name="memberNickname" th:value="${session.member.memberNickname}">
							<input type="hidden" name="boardNo" th:value="${b.boardNo}">	
	                        
	                        <div class="comment-text">
	                            <textarea name="commentContent"></textarea>
	                            <div contenteditable="true" class="comment-write"></div>
	                        </div>
	                        <div class="submit-box">

	                            <button type="submit" class="btn-primary-comment">댓글</button>
	                        </div>
	                    </div>
	                </div>
                </form>
            </div>

			<!-- 댓글 출력 -->
			<th:block th:each="bc : ${b.commentList}">
	            <div class="board-comment">
	                <div class="board-comment-read">
	                    <div class="read-comment-img-box">
	                        <div class="read-comment-img">
	                            <img src="img/about.jpg">
	                        </div>
	                    </div>
	                    <div class="read-comment-content">
	                        <div class="read-comment-user-name">
	                            <div th:text="${bc.memberNickname}"></div>
	                        </div>
	                        <div class="read-comment-user-date">
	                            <div th:text="${bc.commentDate}"></div>
	                        </div>
	                        <div class="read-comment-text">
	                            <p class="comment-read" th:text="${bc.commentContent}"></p>
	                            <textarea name="commentContent"></textarea>
	                            <div contenteditable="true" class="comment-write"></div>
	                           
	                        </div>
	                        <div class="comment-like-box">
	                            <div class="comment-like">
	                                <span class="material-icons">favorite</span>
	                                <span>5</span>
	                            </div>
	                        </div>
	                        <div class="read-submit-box">
	                        <th:block th:if="${session.member != null}">
		                            <button type="button" class="btn-primary-recomment">답글</button>
		                        <th:block th:if="${session.member.memberNickname == bc.memberNickname}">
		                            <button type="button" class="btn-primary-comment-up" th:onclick="modifyComment(this,[[${b.boardNo}]],[[${bc.commentNo}]])">수정</button>
		                            <button type="button" class="btn-primary-del" th:onclick="deleteComment([[${b.boardNo}]],[[${bc.commentNo}]]);">삭제</button>
		                        </th:block>  
	                        </th:block>    
	                        </div>
	                    </div>
	                </div>
	            </div>
	            
	            
	            <!-- 대댓글 출력 -->
				<div class="board-comment" th:each="bcc : ${b.reCommentList}" th:if="${bc.commentNo == bcc.commentRef}">
	                <div class="board-comment-read reBoard-comment-read">
	                    <div class="read-comment-img-box">
	                        <div class="read-comment-img">
	                            <img src="img/about.jpg">
	                        </div>
	                    </div>
	                    <div class="read-comment-content reRead-comment-content">
	                        <div class="read-comment-user-name">
	                            <div th:text="${bcc.memberNickname}"></div>
	                        </div>
	                        <div class="read-comment-user-date">
	                            <div th:text="${bcc.commentDate}"></div>
	                        </div>
	                        <div class="read-comment-text reRead-comment-text">
	                            <p class="comment-read reComment-read" th:text="${bcc.commentContent}"></p>
	                            <textarea name="commentContent"></textarea>
		                        <div contenteditable="true" class="recomment-write"></div>
	                        </div>
	                        <div class="comment-like-box">
	                            <div class="comment-like">
	                                <span class="material-icons">favorite</span>
	                                <span>5</span>
	                            </div>
	                        </div>
	                        <div class="reRead-submit-box">
	                        <th:block th:if="${session.member != null && session.member.memberNickname == bcc.memberNickname}">
	                            <button type="button" class="btn-primary-reComment-up" th:onclick="modifyComment(this,[[${b.boardNo}]],[[${bcc.commentNo}]])">수정</button>
	                            <button type="button" class="btn-primary-del" th:onclick="deleteComment([[${b.boardNo}]],[[${bcc.commentNo}]]);">삭제</button>
	                        </th:block>
	                        </div>
	                    </div>
	                </div>
	            </div>	            
	            

			<!-- 대댓글 입력 -->
	            <div class="board-recomment" th:if="${session.member != null}">
	            	<form action="/board/insertComment" method="post">
		                <div class="board-recomment-write">
		                    <div class="recomment-img-box">
		                        <div class="recomment-img">
		                            <img src="img/about.jpg">
		                        </div>
		                    </div>
		                    <div class="recomment-content">
		                    
							<input type="hidden" name="memberNickname" th:value="${session.member.memberNickname}">
							<input type="hidden" name="boardNo" th:value="${b.boardNo}">	
							<input type="hidden" name="commentRef" th:value="${bc.CommentNo}">		
		
		                        <div class="recomment-text reRecomment-text">
		                            <textarea name="commentContent"></textarea>
		                            <div contenteditable="true" class="recomment-write"></div>
		                        </div>
		                        <div class="comment-submit-box reComment-submit-box">
		                            <button type="button" class="btn-primary-comment-can btn-primary-recomment-can">취소</button>
		                            <button type="submit" class="btn-primary-comment">댓글</button>
		                        </div>
		                    </div>
		                </div>
	                </form>
	            </div>
            </th:block>
            
        </div>   
        
	        
        <th:block th:include="common/footer"></th:block>
        
        <script src="/js/sweetalert.min.js"></script>
        <script>
        $(".navbar-nav").children().eq(3).addClass("active");
        
        $(".navbar-nav").children().eq(3).addClass("active");
        
        
        
        //게시글 삭제
        function deleteBoard(boardNo){
			swal({
				title : "게시글 삭제",
				text : "게시글을 삭제하시겠습니까?",
				icon : "warning",
				buttons : {
					cancel : {
						text : "취소",
						value : false,
						visible : true,
						className : "btn-secondary",
						closeModal : true
					},
					confirm : {
						text : "삭제",
						value : true,
						visible : true,
						className : "btn-primary",
						closeModal : true
					}
				}
			}).then(function(isConfirm){
				if(isConfirm){
					location.href="/board/deleteBoard?boardNo="+boardNo;
				}
			});        	
        }
        //게시글 수정
        function updateBoard(boardNo, memberNickname){
        	location.href="/board/updateFrmBoard?boardNo="+boardNo+"&memberNickname="+memberNickname;
        }
             
        //댓글 전달
        $(".recomment-write").on("input",function(e){
            $(".recomment-text>textarea").val($(this).text());
        });
        $(".comment-write").on("input",function(e){
            $(".comment-text>textarea").val($(this).text());
        });
       
        //답글 출력
        $(".btn-primary-recomment").on("click",function(){
			const index = $(".btn-primary-recomment").index(this);
			console.log(index);
        	$(".board-recomment").eq(index).css("display","block");
        });
        $(".btn-primary-recomment-can").on("click",function(){
			const index = $(".btn-primary-recomment-can").index(this);
			console.log(index);
        	$(".board-recomment").eq(index).css("display","none");
        });
        
        $(".board-like .material-icons").on("click",function(){       		
			$(".board-like .material-icons").css("color","red")
        });
        
        $(".comment-like>.material-icons").on("click",function(){
        	$(".comment-like>.material-icons").css("color","red")
        });
        
        //댓글 수정
        function modifyComment(obj,boardNo,commentNo){
        	//댓글 내용 문자열로
        	const commentContent = $(obj).parent().parent().children().eq(2).children().eq(0).text();
        	//textarea에 담기
        	$(obj).parent().parent().children().eq(2).children().eq(1).text(commentContent);
        	//댓글 내용 수정란에 입력
        	$(obj).parent().parent().children().eq(2).children().last().text(commentContent);
        	
        
        	
        	//댓글 감추기
        	$(obj).parent().parent().children().eq(2).children().eq(0).hide();
        	//댓글 수정란 출력
        	$(obj).parent().parent().children().eq(2).children().eq(2).show(); 
        	
        	//수정 -> 완료
        	$(obj).text("완료");
        	$(obj).attr("onclick","modifyComplete(this,"+boardNo+","+commentNo+");");
        	
        	//삭제 -> 취소
        	$(obj).next().text("취소");
        	$(obj).next().attr("onclick","modifyCancel(this,"+boardNo+","+commentNo+");");
        }
        $(".read-comment-text>.comment-write").on("input",function(e){
        	$(this).prev().val($(this).text());
        });
        
        $(".read-comment-text>.recomment-write").on("input",function(e){
        	$(this).prev().val($(this).text());
        });
            
        //댓글 취소
        function modifyCancel(obj,boardNo,commentNo){
        	//댓글 출력
        	$(obj).parent().parent().children().eq(2).children().eq(0).show();
        	//댓글 수정란 감추기
        	$(obj).parent().parent().children().eq(2).children().eq(2).hide();
        	
        	//완료 -> 수정
        	$(obj).prev().text("수정");
        	$(obj).prev().attr("onclick","modifyComment(this,"+boardNo+","+commentNo+");");
        	
        	//취소 -> 삭제
        	$(obj).text("삭제");
        	$(obj).attr("onclick","deleteComment(this,"+boardNo+","+commentNo+");");
        }
        //댓글 삭제
        function deleteComment(boardNo,commentNo){
        	if(confirm("댓글을 삭제하시겠습니까?")){
            	location.href="/board/deleteComment?boardNo="+boardNo+"&commentNo="+commentNo;
        	}
        }
        
  		//댓글 완료
  		function modifyComplete(obj,boardNo,commentNo){
  			//form
  			const form = $("<form>");
  			form.attr("action","/board/updateComment");
  			form.attr("method","post");
  			form.hide();
  			//boardNo
  			const boardCommentNoInput = $("<input>");
  			boardCommentNoInput.attr("type","text");
  			boardCommentNoInput.attr("name","commentNo")
  			boardCommentNoInput.val(commentNo);
  			//commentNo
  			const boardNoInput = $("<input type='text' name='boardNo'>");
  			boardNoInput.val(boardNo);
  			//textarea
  			const boardCommentContent = $(obj).parent().parent().children().eq(2).children().eq(1)
  			
  			form.append(boardCommentNoInput).append(boardNoInput).append(boardCommentContent);
  			
			$("body").append(form);
			form.submit();
  		}
        
        </script>
</body>
</html>